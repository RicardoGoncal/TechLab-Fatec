name: Debug Runner

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: [self-hosted, linux, X64]

    steps:
      - name: Exibir informaÃ§Ãµes do sistema
        run: |
          echo "ğŸ“Œ Hostname: $(hostname)"
          echo "ğŸ“Œ IP do Servidor: $(hostname -I)"
          echo "ğŸ“Œ UsuÃ¡rio atual: $(whoami)"
          echo "ğŸ“Œ DiretÃ³rio atual: $(pwd)"
          echo "ğŸ“Œ Checando processos ativos do runner:"
          ps aux | grep actions-runner

      - name: Verificar Docker
        run: |
          echo "ğŸ“Œ Verificando se o Docker estÃ¡ instalado..."
          if command -v docker &> /dev/null; then
            echo "âœ… Docker estÃ¡ instalado!"
            echo "ğŸ“Œ VersÃ£o do Docker:"
            docker --version
          else
            echo "âŒ Docker nÃ£o encontrado!"
            exit 1
          fi

      - name: Verificar status do Docker Daemon
        run: |
          echo "ğŸ“Œ Status do serviÃ§o Docker:"
          sudo systemctl status docker || echo "âš ï¸ Falha ao verificar o status"

      - name: Verificar permissÃµes do Docker
        run: |
          echo "ğŸ“Œ Checando permissÃµes do Docker para o usuÃ¡rio atual..."
          if groups | grep -q '\bdocker\b'; then
            echo "âœ… UsuÃ¡rio faz parte do grupo docker"
          else
            echo "âŒ UsuÃ¡rio NÃƒO estÃ¡ no grupo docker"
            echo "ğŸ“Œ Adicionando usuÃ¡rio ao grupo docker..."
            sudo usermod -aG docker $(whoami) || echo "âš ï¸ Falha ao adicionar usuÃ¡rio ao grupo"
            echo "ğŸ“Œ Para aplicar as mudanÃ§as, reinicie o runner manualmente!"
          fi

      - name: Testar acesso ao Docker
        run: |
          echo "ğŸ“Œ Tentando rodar docker ps..."
          docker ps || echo "âš ï¸ Falha ao acessar o Docker (talvez o daemon nÃ£o esteja rodando?)"
